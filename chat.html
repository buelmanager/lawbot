<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI 법률 상담 | LawBot</title>
    <meta name="description" content="노동법, 임대차법, 소비자보호법, 교통사고 4대 분야에 특화된 AI 법률 정보 서비스.">

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#3b82f6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="LawBot">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icons/icon.svg">

    <!-- Fonts -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Styles -->
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="chat.css">

    <!-- 카카오 애드핏 SDK -->
    <script async type="text/javascript" src="//t1.daumcdn.net/kas/static/ba.min.js"></script>
</head>
<body class="chat-page">
    <!-- Particle Canvas Background -->
    <canvas id="particle-canvas"></canvas>

    <!-- Navigation -->
    <nav class="nav">
        <div class="nav-container">
            <a href="index.html" class="nav-logo">
                <div class="logo-icon">
                    <i data-lucide="scale" class="icon-md"></i>
                </div>
                <span class="logo-text">Law<span class="logo-highlight">Bot</span></span>
            </a>

            <div class="nav-links">
                <a href="index.html#features" class="nav-link">서비스 소개</a>
                <a href="index.html#how-it-works" class="nav-link">이용 방법</a>
                <a href="index.html#categories" class="nav-link">상담 분야</a>
                <a href="index.html#faq" class="nav-link">FAQ</a>
                <span class="nav-divider"></span>
                <a href="chat.html" class="nav-link nav-link-highlight active">AI 상담</a>
                <a href="story/index.html" class="nav-link">상담 사연</a>
                <a href="blog/index.html" class="nav-link">블로그</a>
            </div>

            <a href="contact.html" class="nav-cta">
                <span>변호사 상담</span>
                <i data-lucide="arrow-right" class="icon-sm"></i>
            </a>

            <button class="nav-mobile-toggle" aria-label="메뉴 열기">
                <span></span>
                <span></span>
            </button>
        </div>
    </nav>

    <!-- Chat Section -->
    <section class="chat-section">
        <div class="chat-wrapper">
            <!-- 선택된 분야 표시 -->
            <div class="chat-category-header" id="chat-category-header">
                <div class="category-indicator" id="category-indicator">
                    <i data-lucide="briefcase" class="icon-md" id="category-icon"></i>
                    <span id="category-name">노동법</span>
                </div>
                <button class="change-category-btn" id="change-category-btn">
                    <i data-lucide="repeat" class="icon-xs"></i>
                    <span>분야 변경</span>
                </button>
            </div>

            <!-- Chat Container -->
            <div class="chat-container glass-card">
                <div class="chat-header">
                    <div class="chat-status">
                        <span class="status-dot active"></span>
                        <span>AI 상담 가능</span>
                    </div>
                    <div class="chat-info" id="chat-info">법률 정보 서비스</div>
                </div>

                <div class="chat-messages" id="chat-messages">
                    <!-- 메시지가 여기에 표시됨 -->
                </div>

                <div class="chat-input-container">
                    <div class="chat-input-wrapper">
                        <textarea
                            id="chat-input"
                            placeholder="법률 관련 질문을 입력하세요..."
                            rows="1"
                            maxlength="1000"
                        ></textarea>
                        <button id="chat-submit" class="chat-submit-btn" disabled>
                            <i data-lucide="send" class="icon-sm"></i>
                        </button>
                    </div>
                    <p class="chat-disclaimer">
                        <i data-lucide="alert-triangle" class="icon-xs"></i>
                        AI 답변은 참고용이며 실수가 있을 수 있습니다. 법률 자문이 아닙니다.
                    </p>
                </div>
            </div>

            <!-- AI Notice -->
            <div class="chat-ai-notice">
                <i data-lucide="info" class="icon-sm"></i>
                <p>AI가 제공하는 일반적인 법률 정보입니다. 정확하지 않을 수 있으며, 구체적 사안은 변호사와 상담하세요.</p>
            </div>

            <!-- 카카오 애드핏 광고 -->
            <div class="adfit-container">
                <ins class="kakao_ad_area" style="display:none;"
                    data-ad-unit="DAN-XXXXXXXXXXXXXXXXXX"
                    data-ad-width="320"
                    data-ad-height="100"></ins>
            </div>
        </div>
    </section>

    <!-- PWA Install Banner (모바일용) -->
    <div id="pwa-install-banner" class="pwa-install-banner" style="display: none;">
        <div class="pwa-install-content">
            <div class="pwa-install-icon">
                <i data-lucide="download" class="icon-md"></i>
            </div>
            <div class="pwa-install-text">
                <strong>홈 화면에 추가하기</strong>
                <p id="pwa-install-instruction"></p>
            </div>
            <button id="pwa-install-close" class="pwa-install-close">
                <i data-lucide="x" class="icon-sm"></i>
            </button>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
    <script src="https://unpkg.com/lenis@1.1.18/dist/lenis.min.js"></script>
    <script src="chat.js"></script>

    <!-- PWA & Install Banner Script -->
    <script>
        // Service Worker 등록
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(reg => console.log('Service Worker 등록 성공:', reg.scope))
                    .catch(err => console.log('Service Worker 등록 실패:', err));
            });
        }

        // PWA 설치 안내 배너
        (function() {
            const banner = document.getElementById('pwa-install-banner');
            const instruction = document.getElementById('pwa-install-instruction');
            const closeBtn = document.getElementById('pwa-install-close');

            // 이미 PWA로 실행 중이거나, 이미 닫았으면 표시하지 않음
            const isStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone;
            const dismissed = localStorage.getItem('pwa-install-dismissed');

            if (isStandalone || dismissed) return;

            // 모바일 기기 감지
            const userAgent = navigator.userAgent.toLowerCase();
            const isIOS = /iphone|ipad|ipod/.test(userAgent);
            const isAndroid = /android/.test(userAgent);
            const isMobile = isIOS || isAndroid;

            if (!isMobile) return;

            // 안내 문구 설정
            if (isIOS) {
                instruction.innerHTML = '<i data-lucide="share" class="icon-xs" style="display:inline;vertical-align:middle;"></i> 버튼 → "홈 화면에 추가"를 탭하세요';
            } else if (isAndroid) {
                instruction.innerHTML = '메뉴(⋮) → "홈 화면에 추가"를 탭하세요';
            }

            // 배너 표시 (2초 후)
            setTimeout(() => {
                banner.style.display = 'block';
                lucide.createIcons();
            }, 2000);

            // 닫기 버튼
            closeBtn.addEventListener('click', () => {
                banner.style.display = 'none';
                localStorage.setItem('pwa-install-dismissed', 'true');
            });
        })();
    </script>
</body>
</html>
